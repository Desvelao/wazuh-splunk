<!-- Cards for main monitoring section -->
<div layout-align="start stretch" ng-show="mmt.isClusterEnabled && mmt.isClusterRunning">
  <!-- Breadcrumbs -->
  <div layout="row" layout-padding>
    <!-- Main monitoring section -->
    <div ng-if="!mmt.showConfig && !mmt.showNodes">
      <span class="wz-text-link cursor-pointer" ui-sref='manager'>Management</span>
      <span> / </span>
      <span>Monitoring</span>
      <span> / </span>
      <span>{{ mmt.currentApi }}</span>
    </div>
    <!-- Overview section -->
    <div ng-if="mmt.showConfig">
      <span class="wz-text-link cursor-pointer" ui-sref='manager'>Management</span>
      <span> / </span>
      <span class="wz-text-link cursor-pointer" ui-sref='manager'>Monitoring</span>
      <span> / </span>
      <span class="wz-text-link cursor-pointer" ui-sref='mg-monitoring'>{{ mmt.currentApi }}</span>
      <span> / Overview</span>
    </div>
    <!-- The nodes list -->
    <div ng-if="mmt.showNodes && !mmt.currentNode">
      <span class="wz-text-link cursor-pointer" ui-sref='manager'>Management</span>
      <span> / </span>
      <span class="wz-text-link cursor-pointer" ui-sref='manager'>Monitoring</span>
      <span> / </span>
      <span class="wz-text-link cursor-pointer" ui-sref='mg-monitoring'>{{ mmt.currentApi }}</span>
      <span> / </span>
      <span>Nodes</span>
    </div>
    <!-- Single node section -->
    <div ng-if="mmt.currentNode">
      <span class="wz-text-link cursor-pointer" ui-sref='manager'>Management</span>
      <span> / </span>
      <span class="wz-text-link cursor-pointer" ui-sref='manager'>Monitoring</span>
      <span> / </span>
      <span class="wz-text-link cursor-pointer" ui-sref='mg-monitoring'>{{ mmt.currentApi }}</span>
      <span> / </span>
      <span class="wz-text-link cursor-pointer" ng-click="mmt.goNodes()">Nodes</span>
      <span> / </span>
      <span class="wz-text-bold">{{ mmt.currentNode.name }}</span>
    </div>
    <div style="margin-right:7px;" id='input1'></div>
    
  </div>
  <!-- End breadcrumbs -->
  <!-- Headline -->
  <div layout="column" layout-padding>
    <span class="font-size-18"><i class="fa fa-fw fa-search" aria-hidden="true"></i> Monitoring</span>
    <span class="md-subheader">Visualize your Wazuh cluster nodes and its agents</span>
  </div>
  <!-- End headline -->
  <div ng-show='!vm.showConfig && !vm.showNodes'>
    <div layout='row'>
      <!-- Overview card -->
      <md-card layout='column' flex class="wz-md-card">
        <md-card-content>
          <i class="fa fa-fw fa-pie-chart" aria-hidden="true"></i> <span ng-click="mmt.goConfiguration()" class="wz-headline-title wz-text-link cursor-pointer">Overview</span>
          <md-divider class="wz-margin-top-10"></md-divider>
          <div layout="row" class="wz-padding-top-10">
            <span flex="25">IP</span>
            <span class="color-grey">{{mmt.configuration.nodes[0] || 'Unknown'}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="25">Running</span>
            <span class="color-grey">{{ mmt.status || 'no' }}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="25">Version</span>
            <span class="color-grey">{{mmt.version}}</span>
          </div>
        </md-card-content>
      </md-card>
      <!-- End overview card -->
      
      <!-- Info card -->
      <md-card layout='column' flex class="wz-md-card">
        <md-card-content>
          <i class="fa fa-fw fa-info" aria-hidden="true"></i> <span class="wz-headline-title">Information</span>
          <md-divider class="wz-margin-top-10"></md-divider>
          <!-- Nodes -->
          <div layout="row" class="wz-padding-top-10 cursor-pointer" ng-click="mmt.goNodes()">
            <span flex="25" class="wz-text-link" tooltip="Click to open the list of nodes" tooltip-placement="left">Nodes</span>
            <span class="wz-text-link" tooltip="Click to open the list of nodes" tooltip-placement="right">{{mmt.nodesCount}}</span>
          </div>
          <!-- Agents -->
          <div layout="row" class="wz-padding-top-10 cursor-pointer" ui-sref='agents'>
            <span flex="25" class="wz-text-link" tooltip="Click to open the list of agents" tooltip-placement="left">Agents</span>
            <span class="wz-text-link" tooltip="Click to open the list of agents" tooltip-placement="right">{{mmt.agentsCount}}</span>
          </div>
        </md-card-content>
      </md-card>
    </div>
    <div layout="row" layout-align="start stretch" class="height-400">
      <md-card flex class="wz-md-card">
        <md-card-content class="wazuh-column">
          <span class="wz-headline-title">Cluster alerts summary</span>
          <md-divider class="wz-margin-top-10"></md-divider>
          <div id='alertSummary'></div>
        </md-card-content>
      </md-card>
      <md-card flex class="wz-md-card">
        <md-card-content class="wazuh-column">
          <span class="wz-headline-title">Alerts by node summary</span>
          <md-divider class="wz-margin-top-10"></md-divider>
          <div id='alertNodeSummary'></div>
        </md-card-content>
      </md-card>
    </div>
  </div>
  <!-- End info card -->
  <!-- Cards for overview monitoring section -->
  <div layout="row" layout-align="start stretch" ng-show="mmt.showConfig">
    
    <!-- Overview visualization card -->
    <md-card class="wz-md-card">
      <md-card-content class="wazuh-column">
        <span class="wz-headline-title">Top 5 nodes</span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <div id="topNodes"></div>
        <span class="wz-padding-top-10 wz-text-center" ng-show="!rendered">There are no results for selected time range. Try another one.</span>
      </md-card-content>
    </md-card>
    
    <!-- Cluster configuration card -->
    <md-card flex class="wz-md-card">
      <md-card-content>
        <i class="fa fa-fw fa-server" aria-hidden="true"></i> <span class="wz-headline-title">Cluster configuration</span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <!-- Configuration options -->
        <div layout="row" class="wz-padding-top-10">
          <span flex="25">Disabled</span>
          <span class="color-grey">{{mmt.configuration.disabled}}</span>
        </div>
        <div layout="row" class="wz-padding-top-10">
          <span flex="25">Hidden</span>
          <span class="color-grey">{{mmt.configuration.hidden}}</span>
        </div>
        <div layout="row" class="wz-padding-top-10">
          <span flex="25">Name</span>
          <span class="color-grey">{{mmt.configuration.name}}</span>
        </div>
        <div layout="row" class="wz-padding-top-10">
          <span flex="25">Node name</span>
          <span class="color-grey">{{mmt.configuration.node_name}}</span>
        </div>
        <div layout="row" class="wz-padding-top-10">
          <span flex="25">Node type</span>
          <span class="color-grey">{{mmt.configuration.node_type}}</span>
        </div>
        <div layout="row" class="wz-padding-top-10">
          <span flex="25">Bind address</span>
          <span class="color-grey">{{mmt.configuration.bind_addr}}</span>
        </div>
        <div layout="row" class="wz-padding-top-10">
          <span flex="25">IP</span>
          <span class="color-grey">{{mmt.configuration.nodes[0] || 'Unknown'}}</span>
        </div>
        <div layout="row" class="wz-padding-top-10">
          <span flex="25">Port</span>
          <span class="color-grey">{{mmt.configuration.port}}</span>
        </div>
      </md-card-content>
    </md-card>
  </div>
  <!-- End cards for overview monitoring section -->
  <div layout="column" layout-align="start stretch" ng-show="mmt.currentNode">
    
    <!-- Node alerts summary card -->
    <div layout="row" layout-align="start stretch" class="height-250">
      <md-card flex class="wz-md-card">
        <md-card-content class="wazuh-column">
          <span class="wz-headline-title">{{ mmt.currentNode.name }} alerts summary</span>
          <md-divider class="wz-margin-top-10"></md-divider>
          <div id="overviewNode"></div>
        </md-card-content>
      </md-card>
    </div>
    <!-- End node alerts summary card -->
    
    <!-- Node info and files cards section -->
    <div layout="row" class="wz-margin-top-40" layout-align="start stretch" ng-show="mmt.currentNode && mmt.currentNode.healthCheck && mmt.currentNode.healthCheck">
      
      <!-- Node information card -->
      <md-card flex class="wz-md-card" ng-show="mmt.currentNode && mmt.currentNode.healthCheck && mmt.currentNode.healthCheck.info">
        <md-card-content>
          <i class="fa fa-fw fa-info" aria-hidden="true"></i> <span class="wz-headline-title">Node information</span>
          <md-divider class="wz-margin-top-10"></md-divider>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">IP</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.info.ip}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Version</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.info.version}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Type</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.info.type}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Name</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.info.name}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Active agents</span>
            <span class="color-grey">{{ mmt.currentNode.healthCheck.info.n_active_agents }}</span>
          </div>
        </md-card-content>
      </md-card>
      
      <!-- Last files sync card -->
      <md-card flex class="wz-md-card" ng-show="mmt.currentNode && mmt.currentNode.healthCheck && mmt.currentNode.healthCheck.status">
        <md-card-content>
          <i class="fa fa-fw fa-file" aria-hidden="true"></i> <span class="wz-headline-title">Last files integrity synchronization</span>
          <md-divider class="wz-margin-top-10"></md-divider>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Last sync</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_integrity.date_end_master}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Duration</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_integrity.duration}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Total shared files</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_integrity.total_files.shared}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Total missing files</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_integrity.total_files.missing}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Total extra but valid files</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_integrity.total_files.extra_valid}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Total extra files</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_integrity.total_files.extra}}</span>
          </div>
        </md-card-content>
      </md-card>
    </div>
    
    <!-- End node info and files cards section -->
    
    <!-- Node agents cards section -->
    <div layout="row" layout-align="start stretch" ng-show="mmt.currentNode && mmt.currentNode.healthCheck && mmt.currentNode.healthCheck.status">
      
      <!-- Agents sync card -->
      <md-card flex class="wz-md-card">
        <md-card-content>
          <i class="fa fa-fw fa-tv" aria-hidden="true"></i> <span class="wz-headline-title">Last agents information synchronization</span>
          <md-divider class="wz-margin-top-10"></md-divider>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Last sync</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_agentinfo.date_end_master}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Duration</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_agentinfo.duration}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Total agent info</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_agentinfo.total_agentinfo}}</span>
          </div>
        </md-card-content>
      </md-card>
      
      <!-- Groups sync card -->
      <md-card flex class="wz-md-card">
        <md-card-content>
          <i class="fa fa-fw fa-object-group" aria-hidden="true"></i> <span class="wz-headline-title">Last agents groups synchronization</span>
          <md-divider class="wz-margin-top-10"></md-divider>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Last sync</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_agentgroups.date_end_master}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Duration</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_agentgroups.duration}}</span>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <span flex="30">Total agent info</span>
            <span class="color-grey">{{mmt.currentNode.healthCheck.status.last_sync_agentgroups.total_agentgroups}}</span>
          </div>
        </md-card-content>
      </md-card>
    </div>
    <!-- End ode agents cards section -->
  </div>
  
  <div layout="column" ng-if="mmt.showNodes && !mmt.currentNode">
    <div layout="row" class="md-padding">
      <input placeholder="Filter nodes..." ng-model="mmt.custom_search" type="text" class="kuiLocalSearchInput ng-empty ng-pristine ng-scope ng-touched ng-valid"
      aria-invalid="false" wz-enter="mmt.search(mmt.custom_search)">
      <button type="submit" aria-label="Search" class="kuiLocalSearchButton height-40" ng-click="mmt.search(mmt.custom_search)">
        <span class="fa fa-search" aria-hidden="true"></span>
      </button>
    </div>
    <div layout="row" class="md-padding">
      <wazuh-table flex path="'/cluster/nodes'" keys="['name','version','ip','type']" allow-click="true"></wazuh-table>
    </div>
  </div>
</div>
<!-- End cards for main monitoring section -->

<div flex layout="column" ng-show="!mmt.isClusterEnabled || !mmt.isClusterRunning">
  
  <!-- Cluster disabled breadcrumbs -->
  <div layout="row" layout-align="start center">
    <div layout="row" layout-padding>
      <div>
        <span class="wz-text-link cursor-pointer" ui-sref='manager' >Management</span>
        <span> / </span>
        <span>Monitoring</span>
      </div>
    </div>
  </div>
  <!-- End cluster disabled breadcrumbs -->
  <!-- Headline -->
  <div layout="column" layout-padding>
    <span class="font-size-18"><i class="fa fa-fw fa-search" aria-hidden="true"></i> Monitoring</span>
    <span class="md-subheader">Visualize your Wazuh cluster nodes and its agents</span>
  </div>
  <!-- End headline -->
  
  <!-- Cluster disabled section -->
  <div flex layout="row" layout-align="start start" ng-if="!mmt.isClusterEnabled">
    <md-card flex class="wz-md-card" flex>
      <md-card-content class="wz-text-center">
        <i class="fa fa-fw fa-info-circle" aria-hidden="true"></i> <span class="wz-headline-title">Cluster disabled</span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <div layout="column" class="wz-padding-top-10">
          <p>The cluster is disabled. Visit the documentation on <a target="_blank" href="https://documentation.wazuh.com/current/user-manual/manager/wazuh-cluster.html">this link</a> to learn about how to enable it.
          </p>
        </div>
      </md-card-content>
    </md-card>
  </div>
  <!-- End cluster disabled section -->
  
  <!-- Cluster not running section -->
  <div flex layout="row" layout-align="start start" ng-if="!mmt.isClusterRunning && mmt.isClusterEnabled">
    <md-card flex class="wz-md-card" flex>
      <md-card-content class="wz-text-center">
        <i class="fa fa-fw fa-info-circle" aria-hidden="true"></i> <span class="wz-headline-title">Cluster not running</span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <div layout="column" class="wz-padding-top-10">
          <p>
            The cluster is enabled but it's not running.
          </p>
        </div>
      </md-card-content>
    </md-card>
  </div>
  <!-- End cluster not running section -->
  
</div>
