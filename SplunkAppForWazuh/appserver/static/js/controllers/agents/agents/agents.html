<!-- End loading ring -->
<div flex ng-show="!loading" class="md-padding" layout="column" layout-align="start space-around">
  <div layout="row" layout-align="center stretch" class="height-215">
    <md-card flex="15" class="no-margin-left wz-md-card">
      <md-card-content class="md-padding-v">
        <span class="wz-headline-title">Total agents</span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <p class="chart-text" style="top: 65px;position: relative;font-size: 60px;font-weight: bold;text-align: center;">
          {{agentsCountActive + agentsCountDisconnected + agentsCountNeverConnected}}</p>
      </md-card-content>
    </md-card>
    <md-card flex="20" class="no-margin-left wz-md-card">
      <md-card-content class="md-padding-v">
        <span class="wz-headline-title">Status</span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <div layout="row">
          <div style="width: 300px;  height: 125px; padding: 10px;margin: 0 auto">
            <canvas id="agentsPreview1" class="chart-doughnut padding" width="100" height="40" style="position: absolute"></canvas>
          </div>
        </div>
      </md-card-content>
    </md-card>
    <md-card flex="15" class="no-margin-left wz-md-card">
      <md-card-content class="md-padding-v">
        <span class="wz-headline-title">Coverty</span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <div layout="row">
          <div style="width: 150px; height: 125px; padding: 10px;margin: 0 auto">
            <canvas id="agentsPreview2" class="chart-doughnut padding" width="100" height="85" style="position: absolute"></canvas>
            <span class="chart-text" style="top: 55px;position: relative;left: 40px;font-size: 20px;font-weight: bold;">
              {{(agentsCoverity | number:2)}}%</span>
          </div>
        </div>
      </md-card-content>
    </md-card>
    <md-card flex="50" class="no-margin-right wz-md-card">
      <md-card-content class="md-padding-v">
        <span class="wz-headline-title">Top</span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <div class="md-padding">
          <div layout="row" class="wz-padding-top-10">
            <p flex="35" class="manager-status-subtitle">Last registered agent</p>
            <p ng-if="lastAgent.id !== '000'" class="wz-text-right wz-text-bold wz-text-link" ng-click="showAgent(lastAgent)">{{lastAgent.name}}
              <md-tooltip ng-if="lastAgent.id !== '000'" md-direction="right" class="wz-tooltip">
                Click to open this agent
              </md-tooltip>
            </p>
            <p ng-if="lastAgent.id === '000'" class="wz-text-right wz-text-bold wz-text-link">{{lastAgent.name}}
              (manager)
              <md-tooltip ng-if="lastAgent.id !== '000'" md-direction="right" class="wz-tooltip">
                Click to open this agent
              </md-tooltip>
            </p>
          </div>
          <div layout="row" class="wz-padding-top-10">
            <p flex="35" class="manager-status-subtitle">Higher activity</p>
            <p ng-show='!loadingSearch' class="wz-text-right wz-text-bold wz-text-link" ng-click="showAgent(mostActiveAgent)">{{mostActiveAgent}}
              <md-tooltip ng-if="lastAgent.id !== '000'" md-direction="right" class="wz-tooltip">
                Click to open this agent
              </md-tooltip>
            </p>
            <md-progress-circular class="wz-text-right" md-mode="indeterminate" ng-show="loadingSearch"></md-progress-circular>
          </div>
        </div>
      </md-card-content>
    </md-card>
  </div>

  <!-- Search bar -->
  <div ng-if="!loading" layout="row" layout-align="space-between stretch">
    <wz-tag-filter flex path="'/agents'" query-fn="query(q, search)" fields-model="searchBarModel"></wz-tag-filter>
    <button type="submit" aria-label="Search" class="btn wz-button-empty wz-margin-left-10 wz-margin-top-15" ng-click="reloadList()">
      <i class="fa fa-refresh" aria-hidden="true"></i>
      <span>Refresh</span>
    </button>
  </div>


  <md-card class="wz-md-card no-margin-sides wz-margin-top-15">
    <!-- Table -->
    <div ng-if="!loading" layout="row" class="wz-margin-10">
      <wazuh-table flex path="'/agents'" custom-columns="true" keys="['id',{value:'name',size:2},'ip','status','group','os.name','os.version','version', 'dateAdd', 'lastKeepAlive']"
        allow-click="true" rows-per-page="17"></wazuh-table>
    </div>

    <!-- Download CSV -->
    <div layout="row" class="ruleset-csv-formater">
      <span flex></span>
      <a class="small" id="btnDownload" ng-click="downloadCsv()">
        <i aria-hidden="true" class="fa fa-download"></i>&nbsp;Formatted
      </a>
    </div>
  </md-card>


</div>